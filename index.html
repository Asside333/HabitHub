<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HabitHub — MVP offline</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="app-shell">
      <nav class="tabs app-nav" aria-label="Navigation principale">
        <button type="button" class="btn btn-ghost tab-btn is-active" data-tab-target="today" aria-controls="tab-today">
          <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M12 4 4 10v10h16V10z"/><path d="M9 20v-6h6v6"/></svg></span>
          <span class="nav-label">Aujourd'hui</span>
        </button>
        <button type="button" class="btn btn-ghost tab-btn" data-tab-target="catalogue" aria-controls="tab-catalogue">
          <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M4 6h16v14H4z"/><path d="M8 10h8M8 14h5" stroke="currentColor" stroke-width="2" fill="none"/></svg></span>
          <span class="nav-label">Catalogue</span>
        </button>
        <button type="button" class="btn btn-ghost tab-btn" data-tab-target="progression" aria-controls="tab-progression">
          <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M4 18h16v2H4z"/><path d="M7 16V9h2v7zm4 0V6h2v10zm4 0v-4h2v4z"/></svg></span>
          <span class="nav-label">Progression</span>
        </button>
        <button type="button" class="btn btn-ghost tab-btn" data-tab-target="settings" aria-controls="tab-settings">
          <span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M12 8.5A3.5 3.5 0 1 1 8.5 12 3.5 3.5 0 0 1 12 8.5z"/><path d="m20 13.2-1.6.5a6.7 6.7 0 0 1-.4 1l.9 1.4-1.8 1.8-1.4-.9a6.7 6.7 0 0 1-1 .4L13.2 20h-2.4l-.5-1.6a6.7 6.7 0 0 1-1-.4l-1.4.9-1.8-1.8.9-1.4a6.7 6.7 0 0 1-.4-1L4 13.2v-2.4l1.6-.5a6.7 6.7 0 0 1 .4-1L5 7.9l1.8-1.8 1.4.9a6.7 6.7 0 0 1 1-.4L10.8 4h2.4l.5 1.6a6.7 6.7 0 0 1 1 .4l1.4-.9L18 7.9l-.9 1.4a6.7 6.7 0 0 1 .4 1l1.6.5z"/></svg></span>
          <span class="nav-label">Réglages</span>
        </button>
      </nav>

      <section id="tab-today" data-tab-panel="today">
        <section class="card xp-hero" aria-live="polite" aria-labelledby="xp-hero-title">
          <div class="xp-hero-head">
            <h2 id="xp-hero-title">Niveau 1</h2>
            <div class="xp-hero-meta">
              <p id="xp-hero-text" class="xp-hero-text">XP du niveau : 0 / 120</p>
              <span id="level-badge" class="badge badge-level" aria-live="polite">Lv 1</span>
            </div>
          </div>
          <div class="progress-track xp-hero-track" id="xp-hero-track" role="progressbar" aria-label="Progression XP niveau actuel">
            <div id="xp-hero-bar" class="progress-fill xp-hero-fill"></div>
          </div>
          <p id="xp-hero-remaining" class="progress-subtext xp-hero-remaining">Reste: 120 XP</p>
        </section>

        <div class="today-layout">
          <section class="today-stats-row" aria-label="Stats rapides">
            <article class="card stat-chip" aria-label="Points d'expérience">
              <p class="label">XP total</p>
              <strong id="xp-value" class="counter">0</strong>
            </article>
            <article class="card stat-chip" aria-live="polite" aria-label="Streak active">
              <p class="label">Streak</p>
              <strong id="streak-status">Streak: 0 jour(s)</strong>
            </article>
          </section>

          <section class="card quests-section" aria-labelledby="quests-title">
            <h2 id="quests-title">Quêtes du jour</h2>
            <div class="session-progress" aria-live="polite">
              <div class="progress-label-row"><p class="label">Quêtes du jour</p><strong id="session-progress-text">0 / 0</strong></div>
              <div class="progress-track" id="session-progress-track" role="progressbar"><div id="session-progress-bar" class="progress-fill"></div></div>
            </div>
            <ul id="quests-list" class="quests-list"></ul>
            <button id="today-open-progression-btn" class="btn btn-ghost" type="button">Voir progression</button>
          </section>

          <section class="card stats compact-progress" aria-labelledby="stats-title" hidden>
            <div class="stats-head">
              <h2 id="stats-title">Résumé progression</h2>
            </div>
            <p id="streak-protections" class="progress-subtext">Shield: 1/1 • Rest cette semaine: 0/1 • Vacances restantes: 14</p>
            <div id="today-progress-day-bar"></div>
            <div id="today-progress-week-bar"></div>
            <div id="today-progress-boss-bar"></div>
            <button id="claim-weekly-chest-btn" class="btn btn-success" type="button">Claim coffre hebdo</button>

            <div class="level-progress level-progress-secondary" aria-live="polite">
              <div class="progress-label-row"><p class="label">Niveau suivant</p><strong id="level-progress-text">XP du niveau : 0 / 0</strong></div>
              <div class="progress-track" id="level-progress-track" role="progressbar"><div id="level-progress-bar" class="progress-fill level-progress-fill"></div></div>
              <p id="level-progress-remaining" class="progress-subtext">Reste: 0 XP</p>
            </div>
          </section>
        </div>
      </section>

      <section id="tab-progression" data-tab-panel="progression" hidden>
        <section class="card progression-dashboard" aria-labelledby="progression-dashboard-title">
          <h2 id="progression-dashboard-title">Progression complète</h2>

          <article class="progression-section">
            <h3>Jour</h3>
            <p class="progress-subtext">Vue des paliers quotidiens et du cap XP.</p>
            <div id="progression-day-tier-bar"></div>
            <div id="progression-day-cap-bar"></div>
          </article>

          <article class="progression-section">
            <h3>Semaine</h3>
            <p class="progress-subtext">Score hebdo vers coffre, boss et rythme de validation.</p>
            <div id="progression-week-chest-bar"></div>
            <div id="progression-week-boss-threshold-bar"></div>
            <div id="progression-week-days-bar"></div>
          </article>

          <article class="progression-section">
            <h3>Boss</h3>
            <p class="progress-subtext">Progression du boss hebdomadaire.</p>
            <div id="progression-boss-main-bar"></div>
            <p id="progression-boss-streak" class="progress-subtext">Streak boss: 0</p>
          </article>

          <article class="progression-section">
            <h3>Mois</h3>
            <p class="progress-subtext">Points mensuels vers badge.</p>
            <div id="progression-month-bar"></div>
          </article>

          <article class="progression-section">
            <h3>Année</h3>
            <p class="progress-subtext">Reliques et milestones annuels.</p>
            <div id="progression-year-bar"></div>
            <p id="progression-year-milestones" class="progress-subtext">Milestones: -</p>
          </article>
        </section>
      </section>

      <section id="tab-catalogue" data-tab-panel="catalogue" hidden>
        <section class="card manage-panel" aria-labelledby="create-title">
          <div class="create-toolbar">
            <h2 id="create-title">Catalogue des habitudes</h2>
            <div class="toolbar-row">
              <input id="catalog-search-input" type="search" placeholder="Rechercher une habitude…" />
              <button id="new-quest-btn" class="btn btn-primary" type="button">+ Nouvelle habitude</button>
            </div>
            <div class="toolbar-row toolbar-row-controls">
              <label class="control-field" for="catalog-filter-select">Afficher :
                <select id="catalog-filter-select">
                  <option value="all">Toutes</option>
                  <option value="visible">Visibles</option>
                  <option value="hidden">Masquées</option>
                  <option value="seed">Seed (de base)</option>
                  <option value="custom">Custom (personnalisées)</option>
                  <option value="overrides">Modifiées (overrides)</option>
                </select>
              </label>
              <label class="control-field" for="catalog-sort-select">Trier :
                <select id="catalog-sort-select">
                  <option value="recent">Récentes</option>
                  <option value="az">A–Z</option>
                  <option value="xpDesc">XP décroissant</option>
                </select>
              </label>
              <p id="catalog-filter-pill" class="filter-pill" aria-live="polite"></p>
            </div>
            <div class="toolbar-row">
              <button id="bulk-hide-btn" class="btn btn-ghost" type="button">Masquer la sélection</button>
            </div>
          </div>
          <ul id="catalog-list" class="catalog-list"></ul>
        </section>
      </section>

      <section id="tab-settings" data-tab-panel="settings" hidden>
        <section class="card settings-panel" aria-labelledby="settings-title">
          <h2 id="settings-title">Réglages</h2>
          <p class="progress-subtext">Beta Test 1</p>

          <article class="card settings-section" aria-labelledby="settings-general-title">
            <h3 id="settings-general-title">Général</h3>
            <div class="settings-row">
              <label class="toggle-field" for="haptics-toggle">
                <span>Vibrations :</span>
                <input id="haptics-toggle" type="checkbox" role="switch" />
                <strong id="haptics-toggle-state">ON</strong>
              </label>
            </div>
            <div class="settings-row">
              <label class="toggle-field" for="reduce-motion-toggle">
                <span>Réduire animations :</span>
                <input id="reduce-motion-toggle" type="checkbox" role="switch" />
                <strong id="reduce-motion-state">OFF</strong>
              </label>
            </div>
            <div class="settings-row">
              <label class="toggle-field" for="sounds-toggle">
                <span>Sons :</span>
                <input id="sounds-toggle" type="checkbox" role="switch" />
                <strong id="sounds-toggle-state">OFF</strong>
              </label>
            </div>
            <div class="settings-row" id="sounds-volume-row">
              <label class="control-field" for="sounds-volume-range">Volume (0–100)
                <input id="sounds-volume-range" type="range" min="0" max="100" step="1" value="70" />
              </label>
              <strong id="sounds-volume-value">70%</strong>
            </div>
            <div class="settings-row" hidden>
              <label class="toggle-field" for="developer-mode-toggle">
                <span>Mode développeur :</span>
                <input id="developer-mode-toggle" type="checkbox" role="switch" />
                <strong id="developer-mode-state">OFF</strong>
              </label>
            </div>
          </article>

          <article class="card settings-section" aria-labelledby="settings-gameplay-title">
            <h3 id="settings-gameplay-title">Gameplay</h3>
            <div class="settings-row">
              <label class="toggle-field" for="vacation-toggle">
                <span>Mode vacances :</span>
                <input id="vacation-toggle" type="checkbox" role="switch" />
                <strong id="vacation-state">OFF</strong>
              </label>
            </div>
            <p id="vacation-remaining-label" class="progress-subtext">Vacances restantes : 0</p>
          </article>

          <article class="card settings-section" aria-labelledby="settings-economy-title" hidden>
            <h3 id="settings-economy-title">Économie</h3>
            <div class="settings-row">
              <label class="control-field" for="economy-xp-cap-range">Cap XP / jour
                <input id="economy-xp-cap-range" type="range" min="20" max="400" step="5" value="120" />
              </label>
              <strong id="economy-xp-cap-value">120 XP</strong>
            </div>
            <div class="settings-row settings-presets" role="group" aria-label="Preset lissage">
              <span class="label">Lissage :</span>
              <div class="preset-actions">
                <button type="button" class="btn btn-ghost" data-economy-preset="relax">Relax</button>
                <button type="button" class="btn btn-ghost" data-economy-preset="standard">Standard</button>
                <button type="button" class="btn btn-ghost" data-economy-preset="strict">Strict</button>
              </div>
            </div>
            <section class="economy-audit" aria-live="polite" aria-labelledby="economy-audit-title">
              <div class="economy-audit-head">
                <h4 id="economy-audit-title">Audit économie</h4>
                <strong id="economy-audit-status" class="audit-indicator audit-indicator-stable">Vert • progression stable</strong>
              </div>
              <ul class="economy-audit-list">
                <li><span>XP potentielle (habitudes visibles)</span><strong id="economy-audit-potential-xp">0 XP</strong></li>
                <li><span>XP max gagnable aujourd'hui (cap)</span><strong id="economy-audit-max-xp">0 XP</strong></li>
                <li><span>Temps moyen pour passer un niveau</span><strong id="economy-audit-level-time">0 jour</strong></li>
              </ul>
              <p id="economy-audit-source" class="progress-subtext">Base estimation : cap XP/jour</p>
              <div class="settings-actions">
                <button id="economy-audit-recommend-btn" type="button" class="btn btn-ghost">Recommandation</button>
                <p id="economy-audit-recommend-text" class="progress-subtext">Suggestion de cap: -</p>
              </div>
            </section>
          </article>


          <article class="card settings-section" aria-labelledby="settings-backup-title">
            <h3 id="settings-backup-title">Sauvegarde (Beta 1)</h3>
            <p class="progress-subtext">Téléphone → PC : exporte sur téléphone puis importe sur PC.</p>
            <ol class="progress-subtext">
              <li>Sur téléphone, clique sur “Télécharger sauvegarde (.json)”.</li>
              <li>Transfère le fichier sur ton PC.</li>
              <li>Sur PC, choisis le fichier puis clique “Importer”.</li>
            </ol>
            <div class="settings-actions">
              <button id="backup-export-json-btn" class="btn btn-primary" type="button">Télécharger sauvegarde (.json)</button>
            </div>
            <div class="settings-row">
              <label class="control-field" for="backup-import-file-input">Importer un fichier JSON
                <input id="backup-import-file-input" type="file" accept="application/json,.json" />
              </label>
              <button id="backup-import-json-btn" class="btn btn-ghost" type="button">Importer</button>
            </div>
            <div class="settings-actions">
              <button id="backup-copy-code-btn" class="btn btn-ghost" type="button">Copier un code</button>
            </div>
            <label class="control-field" for="backup-code-input">Coller un code
              <textarea id="backup-code-input" rows="4" placeholder="Colle ici ton code de sauvegarde"></textarea>
            </label>
            <div class="settings-actions">
              <button id="backup-restore-code-btn" class="btn btn-primary" type="button">Restaurer</button>
            </div>

            <details class="settings-row">
              <summary>Annexe (expérimental) : QR</summary>
              <p class="progress-subtext">Si la sauvegarde est trop volumineuse, utilise JSON ou Code.</p>
              <div class="settings-actions">
                <button id="backup-show-qr-btn" class="btn btn-ghost" type="button">Afficher QR d’export</button>
              </div>
              <p id="backup-qr-status" class="progress-subtext">QR non généré.</p>
              <div class="settings-actions">
                <button id="backup-scan-qr-btn" class="btn btn-ghost" type="button">Scanner un QR</button>
              </div>
              <p id="backup-qr-scan-status" class="progress-subtext">Scan non supporté sur ce navigateur.</p>
              <canvas id="backup-qr-canvas" hidden aria-label="QR export"></canvas>
            </details>
          </article>
          <article id="developer-settings-section" class="card settings-section" aria-labelledby="settings-dev-title" hidden>
            <h3 id="settings-dev-title">Développeur</h3>
            <div class="settings-row">
              <label class="toggle-field" for="debug-date-toggle">
                <span>Use debug date :</span>
                <input id="debug-date-toggle" type="checkbox" role="switch" />
                <strong id="debug-date-state">OFF</strong>
              </label>
            </div>
            <label class="control-field" for="debug-date-input">Date simulée :
              <input id="debug-date-input" type="date" />
            </label>
            <p id="active-date-label" class="progress-subtext">Date active : -</p>
            <p id="dev-tech-info" class="progress-subtext">Clé save: habitrpg.save • Schéma: -</p>
          </article>

          <article class="card settings-section" aria-labelledby="settings-data-title" hidden>
            <h3 id="settings-data-title">Gestion des données</h3>
            <div class="settings-actions">
              <button id="reset-btn" class="btn btn-danger" type="button">Restart / Reset progression</button>
              <button id="catalog-reset-btn" class="btn btn-danger" type="button">Réinitialiser mon catalogue</button>
            </div>
          </article>
        </section>
      </section>
    </main>

    <div id="quest-editor-modal" class="editor-modal" hidden>
      <div id="editor-backdrop" class="editor-backdrop" data-action="close-editor"></div>
      <aside class="editor-panel" role="dialog" aria-modal="true" aria-labelledby="editor-title">
        <h3 id="editor-title">Nouvelle habitude</h3>
        <form id="quest-editor-form" class="quest-form" novalidate>
          <label class="form-field">Nom<input id="editor-title-input" type="text" minlength="2" maxlength="40" required /></label>
          <div class="effort-field">
            <label class="form-field" for="editor-effort-input">Effort
              <input id="editor-effort-input" class="effort-range" type="range" min="1" max="10" step="1" value="5" />
            </label>
            <p id="editor-effort-label" class="effort-label" aria-live="polite">Moyen</p>
            <p id="editor-reward-preview" class="effort-preview" aria-live="polite">Gains effectifs : +0 XP</p>
          </div>
          <label class="form-field">Rechercher une icône<input id="icon-search-input" type="search" placeholder="Ex: eau, sport..." /></label>
          <div id="icon-grid" class="icon-grid" role="listbox" aria-label="Choix d'icône"></div>
          <p id="editor-error" class="form-error" aria-live="polite"></p>
          <div class="form-actions">
            <button id="editor-save-btn" class="btn btn-primary" type="submit">Enregistrer</button>
            <button id="editor-cancel-btn" class="btn btn-ghost" type="button" data-action="close-editor">Annuler</button>
            <button id="editor-restore-btn" class="btn btn-ghost" type="button" hidden>Restaurer</button>
            <button id="editor-delete-btn" class="btn btn-danger" type="button" hidden>Supprimer</button>
          </div>
        </form>
      </aside>
    </div>


    <div id="qr-scan-modal" class="editor-modal" hidden>
      <div id="qr-scan-backdrop" class="editor-backdrop"></div>
      <aside class="editor-panel" role="dialog" aria-modal="true" aria-labelledby="qr-scan-title">
        <h3 id="qr-scan-title">Scanner un QR (expérimental)</h3>
        <video id="qr-scan-video" autoplay playsinline muted style="width:100%;border-radius:12px;background:#000;"></video>
        <div class="form-actions">
          <button id="qr-scan-close-btn" class="btn btn-ghost" type="button">Fermer</button>
        </div>
      </aside>
    </div>

    <div id="level-up-overlay" class="level-up-overlay" hidden>
      <div class="level-up-modal" role="dialog" aria-modal="true" aria-labelledby="level-up-title" aria-describedby="level-up-message">
        <p id="level-up-title" class="hero-kicker">LEVEL UP</p>
        <h3 id="level-up-level">Niveau atteint</h3>
        <p id="level-up-message"></p>
        <button id="level-up-close-btn" class="btn btn-primary" type="button">Continuer</button>
      </div>
    </div>


    <div id="toast-root" class="toast-root" aria-live="polite" aria-atomic="false"></div>
    <script src="data.js"></script>
    <script src="vendor/qrcodegen.js"></script>
    <script src="game.js"></script>
  </body>
</html>
